<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout1}">
<head>
  	<link rel="stylesheet" th:href="@{/mypage.css}">
  	<title>마이페이지</title>
</head>
<body>
<div layout:fragment="content">

  	<section class="profile-container">
    	<header class="profile-header">
      		<form th:action="@{/user/profile}" method="post" enctype="multipart/form-data" id="profile-form">
				<div class="profile-avatar">
	        		<input type="file" accept=".jpg, .png" id="img-file" name="file"/>
					<label for="img-file"><img th:src="@{'/upload/' + ${#authentication.principal.profile}}"/></label>
				</div>
      		</form>

      		<div class="profile-info-row">
        		<!-- 이름/이메일 -->
        		<form class="inline-name-form" th:action="@{/user/name}" method="post">
          			<div class="name-block">
            			<h1 id="display-name" class="name-view">[[${#authentication.principal.name}]]</h1>
            			<input id="name-input" class="name-edit" type="text" name="name" maxlength="15"/>
            			<div class="name-actions">
              				<button type="button" id="edit-btn" class="btn ghost">수정</button>
              				<button type="submit" id="save-btn" class="btn primary">확인</button>
          					<button type="button" id="cancel-btn" class="btn ghost">취소</button>
           			 	</div>
          			</div>
          			<p class="email">[[${#authentication.principal.username}]]</p>
        		</form>

        		<!-- 우측 액션 -->
        		<div class="utility-actions">
          			<button type="button" id="pw-toggle-btn" class="btn light">비밀번호 변경</button>
          			<a th:href="@{/user/logout}" class="btn light">로그아웃</a>
        		</div>
      		</div>
    	</header>

	    <!-- 비밀번호 변경 패널 -->
		<section class="password-panel">
	      	<h3 class="pw-title">비밀번호 변경</h3>
	      		<form onsubmit="return checkPw()" th:action="@{/user/password}" method="post" class="pw-form">
	        		<div class="pw-row">
	          			<label for="current-password">현재 비밀번호</label>
	          			<input id="current-password" name="current-password" type="password" required autocomplete="current-password">
	        		</div>	
			        <div class="pw-row">
			          	<label for="new-password">새 비밀번호</label>
			          	<input id="new-password" name="new-password" type="password" required autocomplete="new-password">
			          	<p class="pw-hint">8자 이상, 영문/숫자/특수문자 조합 권장</p>
			        </div>
			        <div class="pw-row">
			          	<label for="confirm-password">새 비밀번호 확인</label>
			          	<input id="confirm-password" name="confirmPassword" type="password" required autocomplete="new-confirm-password">
			        </div>
					<div class="err-msg"></div>
					<div th:if="${param.error}" class="err-msg">현재 비밀번호를 확인해 주세요.</div>
			        <div class="pw-actions">
			          	<button type="submit" class="btn primary">변경하기</button>
			          	<button type="button" id="pw-cancel-btn" class="btn ghost">취소</button>
			        </div>
	      		</form>
		</section>
	</section>

	<section class="hate-list">
  		<h3>관심 없어요</h3>
		<div class="books-grid">
      		<div class="book-item" th:each="book : ${hate}">
        		<div class="book-cover">
         			<img th:src="${book.pic}" alt="${book.title}">
        		</div>
	        	<div class="book-info">
	          		<h3 class="book-title">[[${book.title}]]</h3>
	          		<p class="book-meta">[[${book.author}]]</p>
	        	</div>
      		</div>
    	</div>
  	</section>

  	<script th:src="@{/mypage.js}"></script>
</div>
</body>
</html>
